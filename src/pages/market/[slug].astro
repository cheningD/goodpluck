---
import Layout from "@layouts/MainLayout.astro";
import Category from "@components/solid/Category.tsx";
import swell from "../../lib/swell";

const { slug } = Astro.params;
const categories = await swell.categories.list({
  limit: 100,
  page: 1,
});

const collection = categories.results.find((category) => category.slug === slug);

let products =  await swell.products.list({
    category: collection.id, // Slug or ID
    limit: 9,
    page: 1,
  });

if (!collection) return Astro.redirect("/404");
const { name, description } = collection;
---

<Layout
  title={`${name} delivered farm fresh to you`}
  description={description}
  categories={categories.results}
>
  <Category products={products} currentCollection={collection} collections={categories.results} />
</Layout>
