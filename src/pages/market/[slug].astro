---
import Layout from "@layouts/Layout.astro";
import Products from "@components/solid/Products";
import { initSwell } from "../../lib/swell-js";

const swell = initSwell(
  import.meta.env.PUBLIC_SWELL_STORE_ID,
  import.meta.env.PUBLIC_SWELL_PUBLIC_KEY,
);
const categories = await swell.categories.list({
  limit: 100,
  page: 1,
});
const { slug } = Astro.params;

const currentCollection = categories.results.find(
  (category) => category.slug === slug,
);
if (!currentCollection) return Astro.redirect("/404");
const { name, description } = currentCollection;
---

<Layout
  title={`${name}`}
  description="Delivered farm fresh to you"
  categories={categories.results}
  currentCollection={currentCollection}
>
  <Products currentCategory={slug} client:only />
</Layout>
