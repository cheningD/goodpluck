---
import { stytchclient } from "../lib/stytch";

let message = "";
const session_token = Astro.cookies.get("gp_session_token")?.value;

if (session_token) {
  try {
    await stytchclient.sessions.revoke({ session_token });
    Astro.cookies.delete("gp_session_token");
    message = `Success, you are now logged out!`;
  } catch (e) {
    console.error("Error during session revocation:", e);
    message = "Error logging out.";
  }
} else {
  message = "Error, you are not logged in.";
}

// Redirection occurs regardless of the above conditions
Astro.cookies.set("auth_message", message, {
  path: "/",
  httpOnly: true,
  secure: true,
  sameSite: "lax",
});

return Astro.redirect("/");
---
