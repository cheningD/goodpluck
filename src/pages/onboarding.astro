---
import MapboxAutofill from "../components/solid/MapboxAutofill";
import Layout from "@layouts/Layout.astro";

// Environment variables and configurations
const runtime = Astro.locals.runtime;
const env = runtime?.env || import.meta.env;
const mapboxToken = env.MAPBOX_DEFAULT_PUBLIC_TOKEN;

// Redirect unauthenticated users away from create-account page
const isLoggedIn = !!Astro.cookies.get("gp_session_token")?.value;

if (!isLoggedIn) {
  return Astro.redirect(
    "/?message=" + encodeURIComponent("You are not logged in"),
  );
}
---

<Layout>
  <div>
    <h2 class="text-2xl font-bold text-gray-900 my-6 text-center">
      Let's complete your information
    </h2>
    <p class="text-center">
      We need some information to complete your account. Let's complete it
      before you can make your first order!
    </p>

    <p id="error-message" class="text-center text-red-500 mt-4"></p>

    <div class="flex flex-col mt-12 w-1/2 ml-10">
      <form method="POST">
        <label class="block text-sm font-medium text-gray-700 mb-2"
          >Your first name</label
        >
        <input
          type="text"
          name="first_name"
          required
          class="border rounded-md p-2 w-1/2 mb-4"
        />

        <label class="block text-sm font-medium text-gray-700 mb-2"
          >Your last name</label
        >
        <input
          type="text"
          name="last_name"
          required
          class="border rounded-md p-2 w-1/2 mb-4"
        />

        <label class="block text-sm font-medium text-gray-700 mb-2"
          >Your phone number</label
        >
        <input
          type="text"
          name="phone_number"
          required
          class="border rounded-md p-2 w-1/2 mb-4"
        />

        <h3>Your delivery address</h3>

        <label class="block text-sm font-medium text-gray-700 mb-2"
          >Your address</label
        >
        <input
          type="text"
          name="address"
          required
          autocomplete="address-line1"
          class="border rounded-md p-2 w-1/2 mb-4"
        />

        <label class="block text-sm font-medium text-gray-700 mb-2"
          >Your apartment</label
        >
        <input
          type="text"
          name="apartment"
          autocomplete="address-line2"
          class="border rounded-md p-2 w-1/2 mb-4"
        />

        <label class="block text-sm font-medium text-gray-700 mb-2"
          >Your city</label
        >
        <input
          type="text"
          name="city"
          required
          autocomplete="address-level2"
          class="border rounded-md p-2 w-1/2 mb-4"
        />

        <label class="block text-sm font-medium text-gray-700 mb-2"
          >Your postal code</label
        >
        <input
          type="text"
          name="postcode"
          required
          autocomplete="postal-code"
          class="border rounded-md p-2 w-1/2 mb-4"
        />

        <label class="block text-sm font-medium text-gray-700 mb-2"
          >Your state</label
        >
        <input
          type="text"
          name="state"
          required
          autocomplete="address-level1"
          class="border rounded-md p-2 w-1/2 mb-4"
        />

        <label class="block text-sm font-medium text-gray-700 mb-2">
          I consent to receive order updates and other communications to the
          provided phone number
        </label>
        <input
          type="checkbox"
          name="consent"
          required
          class="border rounded-md p-2 w-1/2 mb-4"
        />

        <button
          id="submit-button"
          class="bg-blue-500 text-white rounded-md p-2 w-full mb-2 hover:bg-blue-600"
          type="submit">Submit</button
        >
      </form>
    </div>
  </div>

  <script src="../scripts/onboarding.ts"></script>
  <MapboxAutofill client:only mapboxToken={mapboxToken} />
</Layout>
