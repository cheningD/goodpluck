---
import { BillingAddressCard } from "src/components/solid/BillingAddressCard";
import { BillingInfoCard } from "src/components/solid/BillingInfoCard";
import { SubscriptionCard } from "src/components/solid/SubscriptionCard";
import Layout from "src/layouts/Layout.astro";
import { isLoggedIn } from "src/lib/stytch";

// Redirect unauthenticated users away from account page
const sessionToken = Astro.cookies.get("gp_session_token")?.value;
const isUserLoggedIn = sessionToken && !!(await isLoggedIn(sessionToken));

if (!isUserLoggedIn) {
  return Astro.redirect("/join");
}
---

<Layout title="Account">
  <div>
    <h1 class="text-2xl">Account Info</h1>
    <BillingInfoCard client:load />
    <BillingAddressCard client:load />
    <SubscriptionCard client:load />
  </div>
</Layout>
